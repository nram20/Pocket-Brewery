"use strict";function config(e,t){e.state("home",{url:"/",templateUrl:"/html/home.html",controller:"homeCtrl",controllerAs:"vm"}).state("login",{url:"/login",templateUrl:"/html/login.html",controller:"loginCtrl",controllerAs:"vm"}).state("register",{url:"/register",templateUrl:"/html/registration.html",controller:"regCtrl",controllerAs:"vm"}).state("profile",{url:"/profile",templateUrl:"/html/profile.html",controller:"profileCtrl",controllerAs:"vm"}).state("editProfile",{url:"/editProfile",templateUrl:"/html/editProfile.html",controller:"editProfileCtrl",controllerAs:"vm"}).state("myBeers",{url:"/myBeers",templateUrl:"/html/myBeers.html",controller:"myBeersCtrl",controllerAs:"vm"}).state("allBeers",{url:"/allBeers",templateUrl:"/html/allBeers.html",controller:"allBeersCtrl",controllerAs:"vm"}).state("review",{url:"/review",templateUrl:"/html/review.html",controller:"reviewCtrl",controllerAs:"vm"}).state("reviewspecific",{url:"/reviewspecific/:id",templateUrl:"/html/reviewspecific.html",controller:"reviewspecificCtrl",controllerAs:"vm"}),t.otherwise("/")}function allBeersCtrl(e,t,r){console.log("allBeersCtrl");var o=this;o.notSampled=[],o.startreview=function(){t.go("review")},o.reviewThis=function(e){t.go("reviewspecific",{id:e})},e.getNotSampled().then(function(e){o.notSampled=e.data})}function editProfileCtrl(e,t,r){console.log("editProfileCtrl");var o=this;o.editing={},e.getPerson(r.currentUser).then(function(e){o.editing=e.data}),o.cancel=function(){t.go("profile")},o.save=function(){if(o.editing.password1===o.editing.password2){var n;n=void 0!==o.editing.password1?{email:o.editing.email,password:o.editing.password1}:{email:o.editing.email},e.editprofile(n).then(function(o){e.logout().then(function(e){console.log(e),r.currentUser=null,t.go("home")})})}}}function homeCtrl(e,t){console.log("homeCtrl")}function loginCtrl(e,t,r){console.log("loginCtrl");var o=this;o.credentials={},o.login=function(){e.login(o.credentials).then(function(){t.go("profile")})}}function mainCtrl(e,t,r,o){console.log("mainCtrl");var n=this;n.isLoggedIn=!!o.currentUser,t.$watch(function(){return o.currentUser},function(e,t){n.isLoggedIn=!!e}),n.logOut=function(){e.logout().then(function(e){console.log(e),o.currentUser=null,r.go("home")})}}function myBeersCtrl(e,t,r,o){console.log("myBeersCtrl");var n=this;n.beers={},e.getPerson(r.currentUser).then(function(e){n.beers=e.data.ratings,console.log(n.beers),n.beers=n.beers.filter(function(e){return void 0!==e.score})}),n.deleteRating=function(t){e.deleteRating(t).then(function(t){e.getPerson(r.currentUser).then(function(e){n.beers=e.data.ratings,console.log(n.beers),n.beers=n.beers.filter(function(e){return void 0!==e.score})})})},n.sortBy=function(e){n.sortOrder===e?n.sortOrder="-"+e:n.sortOrder=e},n.editRating=function(e,r,n){o.set({edited:!0,load:{score:r,comment:n}}),t.go("reviewspecific",{id:e})}}function profileCtrl(e,t,r){console.log("profileCtrl");var o=this;o.user={},e.getPerson(r.currentUser).then(function(e){o.user=e.data}),o.editProfile=function(){t.go("editProfile")}}function regCtrl(e,t,r){console.log("regCtrl");var o=this;o.registration={},o.success=!1,o.passwordsNotMatch=!1,o.register=function(){if(o.registration.password1!==o.registration.password2)return o.passwordsNotMatch=!0;var r={email:o.registration.email,password:o.registration.password1};o.success=!0,e.signup(r).then(function(e){t.go("login")})}}function reviewCtrl(e,t,r,o){console.log("reviewCtrl");var n=this;n.beer={},n.loading=!0,n.rating={},o.getRandom().then(function(e){n.beer=e.data,n.loading=!1}),n.rate=function(){var t={beerId:n.beer.id,beerName:n.beer.name,score:n.rating.score,comment:n.rating.comment};e.addRating(t).then(function(e){n.loading=!0,o.getRandom().then(function(e){n.beer=e.data,n.loading=!1})})},n.notsampled=function(){console.log("whhaaat");var t={beerId:n.beer.id,beerName:n.beer.name,score:void 0,comment:void 0};e.addRating(t).then(function(e){n.loading=!0,o.getRandom().then(function(e){n.beer=e.data,n.loading=!1})})}}function reviewspecificCtrl(e,t,r,o,n,i){console.log("reviewspecificCtrl");var l=this;l.beer={},l.loading=!0,l.rating={},o.getById(n.id).then(function(e){l.beer=e.data,l.loading=!1;var t=i.get();t.edited&&(console.log(t.load.score),l.rating.score=t.load.score,l.rating.comment=t.load.comment)}),l.rate=function(){var r={beerId:l.beer.id,beerName:l.beer.name,score:l.rating.score,comment:l.rating.comment};e.addRatingToSpecific(r.beerId,r).then(function(e){var r=i.get();return r.edited?t.go("myBeers"):void t.go("allBeers")})},l.notsampled=function(){t.go("allBeers")}}config.$inject=["$stateProvider","$urlRouterProvider"],allBeersCtrl.$inject=["User","$state","$sessionStorage"],editProfileCtrl.$inject=["User","$state","$sessionStorage"],homeCtrl.$inject=["User","$state"],loginCtrl.$inject=["User","$state","$sessionStorage"],mainCtrl.$inject=["User","$scope","$state","$sessionStorage"],myBeersCtrl.$inject=["User","$state","$sessionStorage","StoreData"],profileCtrl.$inject=["User","$state","$sessionStorage"],regCtrl.$inject=["User","$state","$timeout"],reviewCtrl.$inject=["User","$state","$sessionStorage","BeerAPI"],reviewspecificCtrl.$inject=["User","$state","$sessionStorage","BeerAPI","$stateParams","StoreData"],angular.module("beerApp",["ui.router","ui.bootstrap","angularSpinner","ngStorage"]).config(config),angular.module("beerApp").controller("allBeersCtrl",allBeersCtrl),angular.module("beerApp").controller("editProfileCtrl",editProfileCtrl),angular.module("beerApp").controller("homeCtrl",homeCtrl),angular.module("beerApp").controller("loginCtrl",loginCtrl),angular.module("beerApp").controller("mainCtrl",mainCtrl),angular.module("beerApp").controller("myBeersCtrl",myBeersCtrl),angular.module("beerApp").controller("profileCtrl",profileCtrl),angular.module("beerApp").controller("regCtrl",regCtrl),angular.module("beerApp").controller("reviewCtrl",reviewCtrl),angular.module("beerApp").controller("reviewspecificCtrl",reviewspecificCtrl);var app=angular.module("beerApp");app.service("User",["$http","$sessionStorage",function(e,t){this.signup=function(t){return e.post("./api/users/register",t)},this.login=function(r){return e.post("./api/users/login",r).then(function(e){console.log(e),t.currentUser=e.data})},this.logout=function(t){return e["delete"]("./api/users/logout",t)},this.loadprofile=function(){return e.get("./api/users/profile")},this.editprofile=function(t){return e.put("./api/users/profile",t)},this.getPeople=function(){return e.get("./api/users/people")},this.getPerson=function(t){return e.get("./api/users/people/"+t)},this.addRating=function(t){return e.post("./api/users/addRating/",t)},this.deleteRating=function(t){return e["delete"]("./api/users/deleteRating/"+t)},this.addRatingToSpecific=function(t,r){return e.post("./api/users/addRatingToSpecific/"+t,r)},this.getNotSampled=function(){return e.get("./api/users/getNotSampled")}}]),app.service("BeerAPI",["$http",function(e){this.getRandom=function(){return e.get("./api/beers/getRandom")},this.getById=function(t){return e.get("./api/beers/getById/"+t)}}]),app.service("StoreData",function(){var e={};this.get=function(){return e},this.set=function(t){e=t}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImNvbnRyb2xsZXJzL2FsbEJlZXJzQ3RybC5qcyIsImNvbnRyb2xsZXJzL2VkaXRQcm9maWxlQ3RybC5qcyIsImNvbnRyb2xsZXJzL2hvbWVDdHJsLmpzIiwiY29udHJvbGxlcnMvbG9naW5DdHJsLmpzIiwiY29udHJvbGxlcnMvbWFpbkN0cmwuanMiLCJjb250cm9sbGVycy9teUJlZXJzQ3RybC5qcyIsImNvbnRyb2xsZXJzL3Byb2ZpbGVDdHJsLmpzIiwiY29udHJvbGxlcnMvcmVnQ3RybC5qcyIsImNvbnRyb2xsZXJzL3Jldmlld0N0cmwuanMiLCJjb250cm9sbGVycy9yZXZpZXdzcGVjaWZpY0N0cmwuanMiLCJidW5kbGUuanMiLCJzZXJ2aWNlcy9zZXJ2aWNlcy5qcyJdLCJuYW1lcyI6WyJjb25maWciLCIkc3RhdGVQcm92aWRlciIsIiR1cmxSb3V0ZXJQcm92aWRlciIsInN0YXRlIiwidXJsIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyIiwiY29udHJvbGxlckFzIiwib3RoZXJ3aXNlIiwiYWxsQmVlcnNDdHJsIiwiVXNlciIsIiRzdGF0ZSIsIiRzZXNzaW9uU3RvcmFnZSIsImNvbnNvbGUiLCJsb2ciLCJ2bSIsInRoaXMiLCJub3RTYW1wbGVkIiwic3RhcnRyZXZpZXciLCJnbyIsInJldmlld1RoaXMiLCJpZCIsImdldE5vdFNhbXBsZWQiLCJ0aGVuIiwicmVzIiwiZGF0YSIsImVkaXRQcm9maWxlQ3RybCIsImVkaXRpbmciLCJnZXRQZXJzb24iLCJjdXJyZW50VXNlciIsImNhbmNlbCIsInNhdmUiLCJwYXNzd29yZDEiLCJwYXNzd29yZDIiLCJuZXdVc2VyIiwidW5kZWZpbmVkIiwiZW1haWwiLCJwYXNzd29yZCIsImVkaXRwcm9maWxlIiwibG9nb3V0IiwiaG9tZUN0cmwiLCJsb2dpbkN0cmwiLCJjcmVkZW50aWFscyIsImxvZ2luIiwibWFpbkN0cmwiLCIkc2NvcGUiLCJpc0xvZ2dlZEluIiwiJHdhdGNoIiwibmV3VmFsIiwib2xkVmFsIiwibG9nT3V0IiwibXlCZWVyc0N0cmwiLCJTdG9yZURhdGEiLCJiZWVycyIsInJhdGluZ3MiLCJmaWx0ZXIiLCJiZWVyIiwic2NvcmUiLCJkZWxldGVSYXRpbmciLCJzb3J0QnkiLCJvcmRlciIsInNvcnRPcmRlciIsImVkaXRSYXRpbmciLCJjb21tZW50Iiwic2V0IiwiZWRpdGVkIiwibG9hZCIsInByb2ZpbGVDdHJsIiwidXNlciIsImVkaXRQcm9maWxlIiwicmVnQ3RybCIsIiR0aW1lb3V0IiwicmVnaXN0cmF0aW9uIiwic3VjY2VzcyIsInBhc3N3b3Jkc05vdE1hdGNoIiwicmVnaXN0ZXIiLCJzaWdudXAiLCJyZXZpZXdDdHJsIiwiQmVlckFQSSIsImxvYWRpbmciLCJyYXRpbmciLCJnZXRSYW5kb20iLCJyYXRlIiwicmF0aW5nT2JqIiwiYmVlcklkIiwiYmVlck5hbWUiLCJuYW1lIiwiYWRkUmF0aW5nIiwibm90c2FtcGxlZCIsInJldmlld3NwZWNpZmljQ3RybCIsIiRzdGF0ZVBhcmFtcyIsImdldEJ5SWQiLCJpbmZvIiwiZ2V0IiwiYWRkUmF0aW5nVG9TcGVjaWZpYyIsIiRpbmplY3QiLCJhbmd1bGFyIiwibW9kdWxlIiwiYXBwIiwic2VydmljZSIsIiRodHRwIiwibmV3VXNlck9iaiIsInBvc3QiLCJsb2dpbkRldGFpbHNPYmoiLCJsb2FkcHJvZmlsZSIsImVkaXRlZFVzZXJPYmoiLCJwdXQiLCJnZXRQZW9wbGUiLCJvYmoiLCJzdG9yZURhdGEiXSwibWFwcGluZ3MiOiJBQUFBLFlBUUEsU0FBU0EsUUFBT0MsRUFBZ0JDLEdBRTVCRCxFQUNHRSxNQUFNLFFBQ0xDLElBQUksSUFDSkMsWUFBYSxrQkFDYkMsV0FBWSxXQUNaQyxhQUFjLE9BRWZKLE1BQU0sU0FDTEMsSUFBSSxTQUNKQyxZQUFhLG1CQUNiQyxXQUFZLFlBQ1pDLGFBQWMsT0FFZkosTUFBTSxZQUNMQyxJQUFJLFlBQ0pDLFlBQWEsMEJBQ2JDLFdBQVksVUFDWkMsYUFBYyxPQUVmSixNQUFNLFdBQ0xDLElBQUks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QUNqQixNQUFPSixHQUFNUCxJQUFJLHdCQUduQjdFLEtBQUtzQixZQUFjLFNBQUNtRSxHQUNsQixNQUFPTCxHQUFNTSxJQUFJLHNCQUF1QkQsSUFHMUN6RixLQUFLMkYsVUFBWSxXQUNmLE1BQU9QLEdBQU1QLElBQUksdUJBR25CN0UsS0FBS1ksVUFBWSxTQUFDUCxHQUNoQixNQUFPK0UsR0FBTVAsSUFBSSxzQkFBd0J4RSxJQUczQ0wsS0FBS3VFLFVBQVksU0FBQ0osR0FDaEIsTUFBT2lCLEdBQU1FLEtBQUsseUJBQTBCbkIsSUFHOUNuRSxLQUFLMEMsYUFBZSxTQUFDckMsR0FDbkIsTUFBTytFLEdBQUFBLFVBQWEsNEJBQThCL0UsSUFHcERMLEtBQUs4RSxvQkFBc0IsU0FBQ1YsRUFBUXdCLEdBQ2xDLE1BQU9SLEdBQU1FLEtBQUssbUNBQXFDbEIsRUFBUXdCLElBR2pFNUYsS0FBS00sY0FBZ0IsV0FDbkIsTUFBTzhFLEdBQU1QLElBQUksaUNBS3JCSyxJQUFJQyxRQUFRLFdBQUEsUUFBVyxTQUFTQyxHQUU5QnBGLEtBQUtpRSxVQUFZLFdBQ2YsTUFBT21CLEdBQU1QLElBQUksMEJBR25CN0UsS0FBSzJFLFFBQVUsU0FBQ3RFLEdBQ2QsTUFBTytFLEdBQU1QLElBQUksdUJBQXlCeEUsT0FLOUM2RSxJQUFJQyxRQUFRLFlBQWEsV0FDdkIsR0FBSVUsS0FDSjdGLE1BQUs2RSxJQUFNLFdBQVEsTUFBT2dCLElBQzFCN0YsS0FBS2dELElBQU0sU0FBQ3ZDLEdBQVdvRixFQUFZcEYiLCJmaWxlIjoiYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyXG5cbiAgLm1vZHVsZSgnYmVlckFwcCcsIFsndWkucm91dGVyJywgJ3VpLmJvb3RzdHJhcCcsICdhbmd1bGFyU3Bpbm5lcicsICduZ1N0b3JhZ2UnXSlcblxuICAuY29uZmlnKGNvbmZpZylcblxuZnVuY3Rpb24gY29uZmlnKCRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIpIHtcblxuICAgICRzdGF0ZVByb3ZpZGVyXG4gICAgICAuc3RhdGUoJ2hvbWUnLCB7XG4gICAgICAgIHVybDonLycsXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnL2h0bWwvaG9tZS5odG1sJyxcbiAgICAgICAgY29udHJvbGxlcjogJ2hvbWVDdHJsJyxcbiAgICAgICAgY29udHJvbGxlckFzOiAndm0nXG4gICAgICB9KVxuICAgICAgLnN0YXRlKCdsb2dpbicsIHtcbiAgICAgICAgdXJsOicvbG9naW4nLFxuICAgICAgICB0ZW1wbGF0ZVVybDogJy9odG1sL2xvZ2luLmh0bWwnLFxuICAgICAgICBjb250cm9sbGVyOiAnbG9naW5DdHJsJyxcbiAgICAgICAgY29udHJvbGxlckFzOiAndm0nICAgICAgICBcbiAgICAgIH0pXG4gICAgICAuc3RhdGUoJ3JlZ2lzdGVyJywge1xuICAgICAgICB1cmw6Jy9yZWdpc3RlcicsXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnL2h0bWwvcmVnaXN0cmF0aW9uLmh0bWwnLFxuICAgICAgICBjb250cm9sbGVyOiAncmVnQ3RybCcsXG4gICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyAgICAgICAgXG4gICAgICB9KVxuICAgICAgLnN0YXRlKCdwcm9maWxlJywge1xuICAgICAgICB1cmw6Jy9wcm9maWxlJyxcbiAgICAgICAgdGVtcGxhdGVVcmw6ICcvaHRtbC9wcm9maWxlLmh0bWwnLFxuICAgICAgICBjb250cm9sbGVyOiAncHJvZmlsZUN0cmwnLFxuICAgICAgICBjb250cm9sbGVyQXM6ICd2bScgICAgICAgIFxuICAgICAgfSlcbiAgICAgIC5zdGF0ZSgnZWRpdFByb2ZpbGUnLCB7XG4gICAgICAgIHVybDonL2VkaXRQcm9maWxlJyxcbiAgICAgICAgdGVtcGxhdGVVcmw6ICcvaHRtbC9lZGl0UHJvZmlsZS5odG1sJyxcbiAgICAgICAgY29udHJvbGxlcjogJ2VkaXRQcm9maWxlQ3RybCcsXG4gICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyAgICAgICAgXG4gICAgICB9KVxuICAgICAgLnN0YXRlKCdteUJlZXJzJywge1xuICAgICAgICB1cmw6Jy9teUJlZXJzJyxcbiAgICAgICAgdGVtcGxhdGVVcmw6ICcvaHRtbC9teUJlZXJzLmh0bWwnLFxuICAgICAgICBjb250cm9sbGVyOiAnbXlCZWVyc0N0cmwnLFxuICAgICAgICBjb250cm9sbGVyQXM6ICd2bScgICAgICAgIFxuICAgICAgfSlcbiAgICAgIC5zdGF0ZSgnYWxsQmVlcnMnLCB7XG4gICAgICAgIHVybDonL2FsbEJlZXJzJyxcbiAgICAgICAgdGVtcGxhdGVVcmw6ICcvaHRtbC9hbGxCZWVycy5odG1sJyxcbiAgICAgICAgY29udHJvbGxlcjogJ2FsbEJlZXJzQ3RybCcsXG4gICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJ1xuICAgICAgfSlcbiAgICAgIC5zdGF0ZSgncmV2aWV3Jywge1xuICAgICAgICB1cmw6Jy9yZXZpZXcnLFxuICAgICAgICB0ZW1wbGF0ZVVybDogJy9odG1sL3Jldmlldy5odG1sJyxcbiAgICAgICAgY29udHJvbGxlcjogJ3Jldmlld0N0cmwnLFxuICAgICAgICBjb250cm9sbGVyQXM6ICd2bSdcbiAgICAgIH0pXG4gICAgICAuc3RhdGUoJ3Jldmlld3NwZWNpZmljJywge1xuICAgICAgICB1cmw6Jy9yZXZpZXdzcGVjaWZpYy86aWQnLFxuICAgICAgICB0ZW1wbGF0ZVVybDogJy9odG1sL3Jldmlld3NwZWNpZmljLmh0bWwnLFxuICAgICAgICBjb250cm9sbGVyOiAncmV2aWV3c3BlY2lmaWNDdHJsJyxcbiAgICAgICAgY29udHJvbGxlckFzOiAndm0nXG4gICAgICB9KVxuXG4gICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy8nKTtcbn07IiwiYW5ndWxhci5tb2R1bGUoJ2JlZXJBcHAnKVxuICAuY29udHJvbGxlcignYWxsQmVlcnNDdHJsJywgYWxsQmVlcnNDdHJsKVxuXG5cblxuZnVuY3Rpb24gYWxsQmVlcnNDdHJsKFVzZXIsICRzdGF0ZSwgJHNlc3Npb25TdG9yYWdlKSB7XG4gIGNvbnNvbGUubG9nKCdhbGxCZWVyc0N0cmwnKTtcblxuICB2YXIgdm0gPSB0aGlzO1xuXG4gIHZtLm5vdFNhbXBsZWQgPSBbXTtcblxuICB2bS5zdGFydHJldmlldyA9ICgpID0+IHtcbiAgICAkc3RhdGUuZ28oJ3JldmlldycpO1xuICB9XG5cbiAgdm0ucmV2aWV3VGhpcyA9IChpZCkgPT4ge1xuICAgICRzdGF0ZS5nbygncmV2aWV3c3BlY2lmaWMnLCB7IFwiaWRcIjogaWQgfSk7XG4gIH1cblxuICBVc2VyLmdldE5vdFNhbXBsZWQoKVxuICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgIHZtLm5vdFNhbXBsZWQgPSByZXMuZGF0YTtcbiAgICB9KVxufTsiLCJhbmd1bGFyXG4gIC5tb2R1bGUoJ2JlZXJBcHAnKVxuICBcbiAgLmNvbnRyb2xsZXIoJ2VkaXRQcm9maWxlQ3RybCcsIGVkaXRQcm9maWxlQ3RybClcblxuZnVuY3Rpb24gZWRpdFByb2ZpbGVDdHJsKFVzZXIsICRzdGF0ZSwgJHNlc3Npb25TdG9yYWdlKSB7XG4gIGNvbnNvbGUubG9nKCdlZGl0UHJvZmlsZUN0cmwnKTtcblxuICB2YXIgdm0gPSB0aGlzO1xuXG4gIHZtLmVkaXRpbmcgPSB7fTtcbiAgVXNlci5nZXRQZXJzb24oJHNlc3Npb25TdG9yYWdlLmN1cnJlbnRVc2VyKVxuICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgIHZtLmVkaXRpbmcgPSByZXMuZGF0YTtcbiAgICB9KVxuICB2bS5jYW5jZWwgPSAoKSA9PiB7XG4gICAgJHN0YXRlLmdvKCdwcm9maWxlJyk7XG4gIH1cblxuICB2bS5zYXZlID0gKCkgPT4ge1xuICAgIGlmKHZtLmVkaXRpbmcucGFzc3dvcmQxICE9PSB2bS5lZGl0aW5nLnBhc3N3b3JkMikgcmV0dXJuO1xuICAgIHZhciBuZXdVc2VyO1xuICAgIGlmKHZtLmVkaXRpbmcucGFzc3dvcmQxICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIG5ld1VzZXIgPSB7XG4gICAgICAgIGVtYWlsOiB2bS5lZGl0aW5nLmVtYWlsLFxuICAgICAgICBwYXNzd29yZDogdm0uZWRpdGluZy5wYXNzd29yZDFcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgbmV3VXNlciA9IHtcbiAgICAgICAgZW1haWw6IHZtLmVkaXRpbmcuZW1haWxcbiAgICAgIH1cbiAgICB9XG4gICAgVXNlci5lZGl0cHJvZmlsZShuZXdVc2VyKVxuICAgICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgICBVc2VyLmxvZ291dCgpXG4gICAgICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlcyk7XG4gICAgICAgICAgICAkc2Vzc2lvblN0b3JhZ2UuY3VycmVudFVzZXIgPSBudWxsO1xuICAgICAgICAgICAgJHN0YXRlLmdvKCdob21lJyk7XG4gICAgICAgICAgfSk7XG4gICAgfSlcbiAgfVxufTsiLCJhbmd1bGFyXG4gIC5tb2R1bGUoJ2JlZXJBcHAnKVxuXG4gIC5jb250cm9sbGVyKCdob21lQ3RybCcsIGhvbWVDdHJsKVxuXG5mdW5jdGlvbiBob21lQ3RybChVc2VyLCAkc3RhdGUpIHtcbiAgY29uc29sZS5sb2coJ2hvbWVDdHJsJyk7XG4gIHZhciB2bSA9IHRoaXM7XG59OyIsImFuZ3VsYXJcbiAgICAubW9kdWxlKCdiZWVyQXBwJylcblxuICAgIC5jb250cm9sbGVyKCdsb2dpbkN0cmwnLCBsb2dpbkN0cmwpXG5cbmZ1bmN0aW9uIGxvZ2luQ3RybChVc2VyLCAkc3RhdGUsICRzZXNzaW9uU3RvcmFnZSkge1xuICBjb25zb2xlLmxvZygnbG9naW5DdHJsJyk7XG4gIHZhciB2bSA9IHRoaXM7XG4gIHZtLmNyZWRlbnRpYWxzID0ge307XG4gIHZtLmxvZ2luID0gKCkgPT4ge1xuICAgIFVzZXIubG9naW4odm0uY3JlZGVudGlhbHMpXG4gICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgJHN0YXRlLmdvKCdwcm9maWxlJyk7XG4gICAgICAgICAgfSk7XG4gIH1cbn07XG4iLCJhbmd1bGFyXG4gIC5tb2R1bGUoJ2JlZXJBcHAnKVxuXG4gIC5jb250cm9sbGVyKCdtYWluQ3RybCcsIG1haW5DdHJsKVxuXG5mdW5jdGlvbiBtYWluQ3RybChVc2VyLCAkc2NvcGUsICRzdGF0ZSwgJHNlc3Npb25TdG9yYWdlKSB7XG4gIGNvbnNvbGUubG9nKCdtYWluQ3RybCcpO1xuICB2YXIgdm0gPSB0aGlzO1xuICB2bS5pc0xvZ2dlZEluID0gISEkc2Vzc2lvblN0b3JhZ2UuY3VycmVudFVzZXI7XG4gICRzY29wZS4kd2F0Y2goZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuICRzZXNzaW9uU3RvcmFnZS5jdXJyZW50VXNlcjtcbiAgfSwgZnVuY3Rpb24obmV3VmFsLCBvbGRWYWwpIHtcbiAgICB2bS5pc0xvZ2dlZEluID0gISFuZXdWYWw7XG4gIH0pO1xuXG4gIHZtLmxvZ091dCA9ICgpID0+IHtcbiAgICBVc2VyLmxvZ291dCgpXG4gICAgICAudGhlbihyZXMgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhyZXMpO1xuICAgICAgICAkc2Vzc2lvblN0b3JhZ2UuY3VycmVudFVzZXIgPSBudWxsO1xuICAgICAgICAkc3RhdGUuZ28oJ2hvbWUnKTtcbiAgICAgIH0pO1xuICB9XG59OyIsImFuZ3VsYXJcblxuICAubW9kdWxlKCdiZWVyQXBwJylcblxuICAuY29udHJvbGxlcignbXlCZWVyc0N0cmwnLCBteUJlZXJzQ3RybCkgXG5cbmZ1bmN0aW9uIG15QmVlcnNDdHJsKFVzZXIsICRzdGF0ZSwgJHNlc3Npb25TdG9yYWdlLCBTdG9yZURhdGEpIHtcbiAgY29uc29sZS5sb2coJ215QmVlcnNDdHJsJyk7XG4gIHZhciB2bSA9IHRoaXM7XG4gIHZtLmJlZXJzID0ge307XG4gIFVzZXIuZ2V0UGVyc29uKCRzZXNzaW9uU3RvcmFnZS5jdXJyZW50VXNlcilcbiAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICB2bS5iZWVycyA9IHJlcy5kYXRhLnJhdGluZ3M7XG4gICAgICBjb25zb2xlLmxvZyh2bS5iZWVycyk7XG4gICAgICB2bS5iZWVycyA9IHZtLmJlZXJzLmZpbHRlcigoYmVlcikgPT4ge1xuICAgICAgICByZXR1cm4gYmVlci5zY29yZSAhPT0gdW5kZWZpbmVkO1xuICAgICAgfSlcbiAgICB9KVxuICB2bS5kZWxldGVSYXRpbmcgPSAoaWQpID0+IHtcbiAgICBVc2VyLmRlbGV0ZVJhdGluZyhpZClcbiAgICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgICAgVXNlci5nZXRQZXJzb24oJHNlc3Npb25TdG9yYWdlLmN1cnJlbnRVc2VyKVxuICAgICAgICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgICAgICAgIHZtLmJlZXJzID0gcmVzLmRhdGEucmF0aW5ncztcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHZtLmJlZXJzKTtcbiAgICAgICAgICAgIHZtLmJlZXJzID0gdm0uYmVlcnMuZmlsdGVyKChiZWVyKSA9PiB7XG4gICAgICAgICAgICAgIHJldHVybiBiZWVyLnNjb3JlICE9PSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH0pXG4gICAgICB9KVxuICB9XG5cbiAgdm0uc29ydEJ5ID0gKG9yZGVyKSA9PiB7XG4gICAgaWYodm0uc29ydE9yZGVyID09PSBvcmRlcikge1xuICAgICAgdm0uc29ydE9yZGVyID0gXCItXCIgKyBvcmRlcjtcbiAgICB9IGVsc2Uge1xuICAgICAgdm0uc29ydE9yZGVyID0gb3JkZXI7XG4gICAgfVxuICB9O1xuXG4gIHZtLmVkaXRSYXRpbmcgPSAoaWQsIHNjb3JlLCBjb21tZW50KSA9PiB7XG4gICAgU3RvcmVEYXRhLnNldCh7J2VkaXRlZCc6IHRydWUsIFwibG9hZFwiOiB7IFwic2NvcmVcIjogc2NvcmUsIFwiY29tbWVudFwiOiBjb21tZW50IH19KTtcbiAgICAkc3RhdGUuZ28oJ3Jldmlld3NwZWNpZmljJywgeyBcImlkXCI6IGlkIH0pO1xuICB9XG59OyIsImFuZ3VsYXJcbiAgLm1vZHVsZSgnYmVlckFwcCcpXG5cbiAgLmNvbnRyb2xsZXIoJ3Byb2ZpbGVDdHJsJywgcHJvZmlsZUN0cmwpXG5cbmZ1bmN0aW9uIHByb2ZpbGVDdHJsKFVzZXIsICRzdGF0ZSwgJHNlc3Npb25TdG9yYWdlKSB7XG4gIGNvbnNvbGUubG9nKCdwcm9maWxlQ3RybCcpO1xuICB2YXIgdm0gPSB0aGlzO1xuICB2bS51c2VyID0ge307XG4gIFVzZXIuZ2V0UGVyc29uKCRzZXNzaW9uU3RvcmFnZS5jdXJyZW50VXNlcilcbiAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICB2bS51c2VyID0gcmVzLmRhdGE7XG4gICAgfSlcbiAgdm0uZWRpdFByb2ZpbGUgPSAoKSA9PiB7XG4gICAgJHN0YXRlLmdvKCdlZGl0UHJvZmlsZScpO1xuICB9XG59OyIsImFuZ3VsYXJcblxuICAubW9kdWxlKCdiZWVyQXBwJylcblxuICAuY29udHJvbGxlcigncmVnQ3RybCcsIHJlZ0N0cmwpXG5cbmZ1bmN0aW9uIHJlZ0N0cmwoVXNlciwgJHN0YXRlLCAkdGltZW91dCkge1xuICBjb25zb2xlLmxvZygncmVnQ3RybCcpO1xuICB2YXIgdm0gPSB0aGlzO1xuICB2bS5yZWdpc3RyYXRpb24gPSB7fTtcbiAgdm0uc3VjY2VzcyA9IGZhbHNlO1xuICB2bS5wYXNzd29yZHNOb3RNYXRjaCA9IGZhbHNlO1xuICB2bS5yZWdpc3RlciA9ICgpID0+IHtcbiAgICBpZih2bS5yZWdpc3RyYXRpb24ucGFzc3dvcmQxICE9PSB2bS5yZWdpc3RyYXRpb24ucGFzc3dvcmQyKSByZXR1cm4gdm0ucGFzc3dvcmRzTm90TWF0Y2ggPSB0cnVlO1xuICAgIHZhciBuZXdVc2VyID0ge1xuICAgICAgZW1haWw6IHZtLnJlZ2lzdHJhdGlvbi5lbWFpbCxcbiAgICAgIHBhc3N3b3JkOiB2bS5yZWdpc3RyYXRpb24ucGFzc3dvcmQxXG4gICAgfVxuICAgIHZtLnN1Y2Nlc3MgPSB0cnVlO1xuICAgIFVzZXIuc2lnbnVwKG5ld1VzZXIpXG4gICAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICAgICAgJHN0YXRlLmdvKCdsb2dpbicpXG4gICAgICB9KVxuICB9XG59O1xuIiwiYW5ndWxhclxuXG4gIC5tb2R1bGUoJ2JlZXJBcHAnKVxuXG4gIC5jb250cm9sbGVyKCdyZXZpZXdDdHJsJywgcmV2aWV3Q3RybClcblxuZnVuY3Rpb24gcmV2aWV3Q3RybChVc2VyLCAkc3RhdGUsICRzZXNzaW9uU3RvcmFnZSwgQmVlckFQSSkge1xuICBjb25zb2xlLmxvZygncmV2aWV3Q3RybCcpO1xuICB2YXIgdm0gPSB0aGlzO1xuICB2bS5iZWVyID0ge307XG4gIHZtLmxvYWRpbmcgPSB0cnVlO1xuICB2bS5yYXRpbmcgPSB7fTtcbiAgQmVlckFQSS5nZXRSYW5kb20oKVxuICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgIHZtLmJlZXIgPSByZXMuZGF0YTtcbiAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICB9KVxuICB2bS5yYXRlID0gKCkgPT4ge1xuICAgIHZhciByYXRpbmdPYmogPSB7XG4gICAgICBiZWVySWQ6IHZtLmJlZXIuaWQsXG4gICAgICBiZWVyTmFtZTogdm0uYmVlci5uYW1lLFxuICAgICAgc2NvcmU6IHZtLnJhdGluZy5zY29yZSxcbiAgICAgIGNvbW1lbnQ6IHZtLnJhdGluZy5jb21tZW50XG4gICAgfVxuICAgIFVzZXIuYWRkUmF0aW5nKHJhdGluZ09iailcbiAgICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgIEJlZXJBUEkuZ2V0UmFuZG9tKClcbiAgICAgICAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICAgICAgICB2bS5iZWVyID0gcmVzLmRhdGE7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgfSlcbiAgICAgIH0pXG4gIH1cblxuICB2bS5ub3RzYW1wbGVkID0gKCkgPT4ge1xuICAgIGNvbnNvbGUubG9nKCd3aGhhYWF0Jyk7XG4gICAgdmFyIHJhdGluZ09iaiA9IHtcbiAgICAgIGJlZXJJZDogdm0uYmVlci5pZCxcbiAgICAgIGJlZXJOYW1lOiB2bS5iZWVyLm5hbWUsXG4gICAgICBzY29yZTogdW5kZWZpbmVkLFxuICAgICAgY29tbWVudDogdW5kZWZpbmVkXG4gICAgfVxuICAgIFVzZXIuYWRkUmF0aW5nKHJhdGluZ09iailcbiAgICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgIEJlZXJBUEkuZ2V0UmFuZG9tKClcbiAgICAgICAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICAgICAgICB2bS5iZWVyID0gcmVzLmRhdGE7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgfSlcbiAgICAgIH0pXG4gIH1cblxufTsiLCJhbmd1bGFyXG4gIC5tb2R1bGUoJ2JlZXJBcHAnKVxuXG4gIC5jb250cm9sbGVyKCdyZXZpZXdzcGVjaWZpY0N0cmwnLCByZXZpZXdzcGVjaWZpY0N0cmwpXG5cbmZ1bmN0aW9uIHJldmlld3NwZWNpZmljQ3RybChVc2VyLCAkc3RhdGUsICRzZXNzaW9uU3RvcmFnZSwgQmVlckFQSSwgJHN0YXRlUGFyYW1zLCBTdG9yZURhdGEpIHtcbiAgY29uc29sZS5sb2coJ3Jldmlld3NwZWNpZmljQ3RybCcpO1xuICB2YXIgdm0gPSB0aGlzO1xuICB2bS5iZWVyID0ge307XG4gIHZtLmxvYWRpbmcgPSB0cnVlO1xuICB2bS5yYXRpbmcgPSB7fTtcblxuICBCZWVyQVBJLmdldEJ5SWQoJHN0YXRlUGFyYW1zLmlkKVxuICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgIHZtLmJlZXIgPSByZXMuZGF0YTtcbiAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgIHZhciBpbmZvID0gU3RvcmVEYXRhLmdldCgpO1xuICAgICAgaWYoaW5mby5lZGl0ZWQpIHtcbiAgICAgICAgY29uc29sZS5sb2coaW5mby5sb2FkLnNjb3JlKTtcbiAgICAgICAgdm0ucmF0aW5nLnNjb3JlID0gaW5mby5sb2FkLnNjb3JlO1xuICAgICAgICB2bS5yYXRpbmcuY29tbWVudCA9IGluZm8ubG9hZC5jb21tZW50O1xuICAgICAgfVxuICAgIH0pXG5cblxuICB2bS5yYXRlID0gKCkgPT4ge1xuICAgIHZhciByYXRpbmdPYmogPSB7XG4gICAgICBiZWVySWQ6IHZtLmJlZXIuaWQsXG4gICAgICBiZWVyTmFtZTogdm0uYmVlci5uYW1lLFxuICAgICAgc2NvcmU6IHZtLnJhdGluZy5zY29yZSxcbiAgICAgIGNvbW1lbnQ6IHZtLnJhdGluZy5jb21tZW50XG4gICAgfVxuICAgIFVzZXIuYWRkUmF0aW5nVG9TcGVjaWZpYyhyYXRpbmdPYmouYmVlcklkLCByYXRpbmdPYmopXG4gICAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICAgIHZhciBpbmZvID0gU3RvcmVEYXRhLmdldCgpO1xuXG4gICAgICAgIGlmKGluZm8uZWRpdGVkKSByZXR1cm4gJHN0YXRlLmdvKCdteUJlZXJzJyk7XG4gICAgICAgICRzdGF0ZS5nbygnYWxsQmVlcnMnKVxuICAgICAgfSlcbiAgfVxuXG4gIHZtLm5vdHNhbXBsZWQgPSAoKSA9PiB7XG4gICAgJHN0YXRlLmdvKCdhbGxCZWVycycpXG4gIH1cblxufTsiLCIndXNlIHN0cmljdCc7XG5cbmFuZ3VsYXIubW9kdWxlKCdiZWVyQXBwJywgWyd1aS5yb3V0ZXInLCAndWkuYm9vdHN0cmFwJywgJ2FuZ3VsYXJTcGlubmVyJywgJ25nU3RvcmFnZSddKS5jb25maWcoY29uZmlnKTtcblxuZnVuY3Rpb24gY29uZmlnKCRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIpIHtcblxuICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnaG9tZScsIHtcbiAgICB1cmw6ICcvJyxcbiAgICB0ZW1wbGF0ZVVybDogJy9odG1sL2hvbWUuaHRtbCcsXG4gICAgY29udHJvbGxlcjogJ2hvbWVDdHJsJyxcbiAgICBjb250cm9sbGVyQXM6ICd2bSdcbiAgfSkuc3RhdGUoJ2xvZ2luJywge1xuICAgIHVybDogJy9sb2dpbicsXG4gICAgdGVtcGxhdGVVcmw6ICcvaHRtbC9sb2dpbi5odG1sJyxcbiAgICBjb250cm9sbGVyOiAnbG9naW5DdHJsJyxcbiAgICBjb250cm9sbGVyQXM6ICd2bSdcbiAgfSkuc3RhdGUoJ3JlZ2lzdGVyJywge1xuICAgIHVybDogJy9yZWdpc3RlcicsXG4gICAgdGVtcGxhdGVVcmw6ICcvaHRtbC9yZWdpc3RyYXRpb24uaHRtbCcsXG4gICAgY29udHJvbGxlcjogJ3JlZ0N0cmwnLFxuICAgIGNvbnRyb2xsZXJBczogJ3ZtJ1xuICB9KS5zdGF0ZSgncHJvZmlsZScsIHtcbiAgICB1cmw6ICcvcHJvZmlsZScsXG4gICAgdGVtcGxhdGVVcmw6ICcvaHRtbC9wcm9maWxlLmh0bWwnLFxuICAgIGNvbnRyb2xsZXI6ICdwcm9maWxlQ3RybCcsXG4gICAgY29udHJvbGxlckFzOiAndm0nXG4gIH0pLnN0YXRlKCdlZGl0UHJvZmlsZScsIHtcbiAgICB1cmw6ICcvZWRpdFByb2ZpbGUnLFxuICAgIHRlbXBsYXRlVXJsOiAnL2h0bWwvZWRpdFByb2ZpbGUuaHRtbCcsXG4gICAgY29udHJvbGxlcjogJ2VkaXRQcm9maWxlQ3RybCcsXG4gICAgY29udHJvbGxlckFzOiAndm0nXG4gIH0pLnN0YXRlKCdteUJlZXJzJywge1xuICAgIHVybDogJy9teUJlZXJzJyxcbiAgICB0ZW1wbGF0ZVVybDogJy9odG1sL215QmVlcnMuaHRtbCcsXG4gICAgY29udHJvbGxlcjogJ215QmVlcnNDdHJsJyxcbiAgICBjb250cm9sbGVyQXM6ICd2bSdcbiAgfSkuc3RhdGUoJ2FsbEJlZXJzJywge1xuICAgIHVybDogJy9hbGxCZWVycycsXG4gICAgdGVtcGxhdGVVcmw6ICcvaHRtbC9hbGxCZWVycy5odG1sJyxcbiAgICBjb250cm9sbGVyOiAnYWxsQmVlcnNDdHJsJyxcbiAgICBjb250cm9sbGVyQXM6ICd2bSdcbiAgfSkuc3RhdGUoJ3JldmlldycsIHtcbiAgICB1cmw6ICcvcmV2aWV3JyxcbiAgICB0ZW1wbGF0ZVVybDogJy9odG1sL3Jldmlldy5odG1sJyxcbiAgICBjb250cm9sbGVyOiAncmV2aWV3Q3RybCcsXG4gICAgY29udHJvbGxlckFzOiAndm0nXG4gIH0pLnN0YXRlKCdyZXZpZXdzcGVjaWZpYycsIHtcbiAgICB1cmw6ICcvcmV2aWV3c3BlY2lmaWMvOmlkJyxcbiAgICB0ZW1wbGF0ZVVybDogJy9odG1sL3Jldmlld3NwZWNpZmljLmh0bWwnLFxuICAgIGNvbnRyb2xsZXI6ICdyZXZpZXdzcGVjaWZpY0N0cmwnLFxuICAgIGNvbnRyb2xsZXJBczogJ3ZtJ1xuICB9KTtcblxuICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvJyk7XG59O1xuJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyLm1vZHVsZSgnYmVlckFwcCcpLmNvbnRyb2xsZXIoJ2FsbEJlZXJzQ3RybCcsIGFsbEJlZXJzQ3RybCk7XG5cbmZ1bmN0aW9uIGFsbEJlZXJzQ3RybChVc2VyLCAkc3RhdGUsICRzZXNzaW9uU3RvcmFnZSkge1xuICBjb25zb2xlLmxvZygnYWxsQmVlcnNDdHJsJyk7XG5cbiAgdmFyIHZtID0gdGhpcztcblxuICB2bS5ub3RTYW1wbGVkID0gW107XG5cbiAgdm0uc3RhcnRyZXZpZXcgPSBmdW5jdGlvbiAoKSB7XG4gICAgJHN0YXRlLmdvKCdyZXZpZXcnKTtcbiAgfTtcblxuICB2bS5yZXZpZXdUaGlzID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgJHN0YXRlLmdvKCdyZXZpZXdzcGVjaWZpYycsIHsgXCJpZFwiOiBpZCB9KTtcbiAgfTtcblxuICBVc2VyLmdldE5vdFNhbXBsZWQoKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcbiAgICB2bS5ub3RTYW1wbGVkID0gcmVzLmRhdGE7XG4gIH0pO1xufTtcbid1c2Ugc3RyaWN0JztcblxuYW5ndWxhci5tb2R1bGUoJ2JlZXJBcHAnKS5jb250cm9sbGVyKCdlZGl0UHJvZmlsZUN0cmwnLCBlZGl0UHJvZmlsZUN0cmwpO1xuXG5mdW5jdGlvbiBlZGl0UHJvZmlsZUN0cmwoVXNlciwgJHN0YXRlLCAkc2Vzc2lvblN0b3JhZ2UpIHtcbiAgY29uc29sZS5sb2coJ2VkaXRQcm9maWxlQ3RybCcpO1xuXG4gIHZhciB2bSA9IHRoaXM7XG5cbiAgdm0uZWRpdGluZyA9IHt9O1xuICBVc2VyLmdldFBlcnNvbigkc2Vzc2lvblN0b3JhZ2UuY3VycmVudFVzZXIpLnRoZW4oZnVuY3Rpb24gKHJlcykge1xuICAgIHZtLmVkaXRpbmcgPSByZXMuZGF0YTtcbiAgfSk7XG4gIHZtLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAkc3RhdGUuZ28oJ3Byb2ZpbGUnKTtcbiAgfTtcblxuICB2bS5zYXZlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmICh2bS5lZGl0aW5nLnBhc3N3b3JkMSAhPT0gdm0uZWRpdGluZy5wYXNzd29yZDIpIHJldHVybjtcbiAgICB2YXIgbmV3VXNlcjtcbiAgICBpZiAodm0uZWRpdGluZy5wYXNzd29yZDEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgbmV3VXNlciA9IHtcbiAgICAgICAgZW1haWw6IHZtLmVkaXRpbmcuZW1haWwsXG4gICAgICAgIHBhc3N3b3JkOiB2bS5lZGl0aW5nLnBhc3N3b3JkMVxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgbmV3VXNlciA9IHtcbiAgICAgICAgZW1haWw6IHZtLmVkaXRpbmcuZW1haWxcbiAgICAgIH07XG4gICAgfVxuICAgIFVzZXIuZWRpdHByb2ZpbGUobmV3VXNlcikudGhlbihmdW5jdGlvbiAocmVzKSB7XG4gICAgICBVc2VyLmxvZ291dCgpLnRoZW4oZnVuY3Rpb24gKHJlcykge1xuICAgICAgICBjb25zb2xlLmxvZyhyZXMpO1xuICAgICAgICAkc2Vzc2lvblN0b3JhZ2UuY3VycmVudFVzZXIgPSBudWxsO1xuICAgICAgICAkc3RhdGUuZ28oJ2hvbWUnKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xufTtcbid1c2Ugc3RyaWN0JztcblxuYW5ndWxhci5tb2R1bGUoJ2JlZXJBcHAnKS5jb250cm9sbGVyKCdob21lQ3RybCcsIGhvbWVDdHJsKTtcblxuZnVuY3Rpb24gaG9tZUN0cmwoVXNlciwgJHN0YXRlKSB7XG4gIGNvbnNvbGUubG9nKCdob21lQ3RybCcpO1xuICB2YXIgdm0gPSB0aGlzO1xufTtcbid1c2Ugc3RyaWN0JztcblxuYW5ndWxhci5tb2R1bGUoJ2JlZXJBcHAnKS5jb250cm9sbGVyKCdsb2dpbkN0cmwnLCBsb2dpbkN0cmwpO1xuXG5mdW5jdGlvbiBsb2dpbkN0cmwoVXNlciwgJHN0YXRlLCAkc2Vzc2lvblN0b3JhZ2UpIHtcbiAgY29uc29sZS5sb2coJ2xvZ2luQ3RybCcpO1xuICB2YXIgdm0gPSB0aGlzO1xuICB2bS5jcmVkZW50aWFscyA9IHt9O1xuICB2bS5sb2dpbiA9IGZ1bmN0aW9uICgpIHtcbiAgICBVc2VyLmxvZ2luKHZtLmNyZWRlbnRpYWxzKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICRzdGF0ZS5nbygncHJvZmlsZScpO1xuICAgIH0pO1xuICB9O1xufTtcbid1c2Ugc3RyaWN0JztcblxuYW5ndWxhci5tb2R1bGUoJ2JlZXJBcHAnKS5jb250cm9sbGVyKCdtYWluQ3RybCcsIG1haW5DdHJsKTtcblxuZnVuY3Rpb24gbWFpbkN0cmwoVXNlciwgJHNjb3BlLCAkc3RhdGUsICRzZXNzaW9uU3RvcmFnZSkge1xuICBjb25zb2xlLmxvZygnbWFpbkN0cmwnKTtcbiAgdmFyIHZtID0gdGhpcztcbiAgdm0uaXNMb2dnZWRJbiA9ICEhJHNlc3Npb25TdG9yYWdlLmN1cnJlbnRVc2VyO1xuICAkc2NvcGUuJHdhdGNoKGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gJHNlc3Npb25TdG9yYWdlLmN1cnJlbnRVc2VyO1xuICB9LCBmdW5jdGlvbiAobmV3VmFsLCBvbGRWYWwpIHtcbiAgICB2bS5pc0xvZ2dlZEluID0gISFuZXdWYWw7XG4gIH0pO1xuXG4gIHZtLmxvZ091dCA9IGZ1bmN0aW9uICgpIHtcbiAgICBVc2VyLmxvZ291dCgpLnRoZW4oZnVuY3Rpb24gKHJlcykge1xuICAgICAgY29uc29sZS5sb2cocmVzKTtcbiAgICAgICRzZXNzaW9uU3RvcmFnZS5jdXJyZW50VXNlciA9IG51bGw7XG4gICAgICAkc3RhdGUuZ28oJ2hvbWUnKTtcbiAgICB9KTtcbiAgfTtcbn07XG4ndXNlIHN0cmljdCc7XG5cbmFuZ3VsYXIubW9kdWxlKCdiZWVyQXBwJykuY29udHJvbGxlcignbXlCZWVyc0N0cmwnLCBteUJlZXJzQ3RybCk7XG5cbmZ1bmN0aW9uIG15QmVlcnNDdHJsKFVzZXIsICRzdGF0ZSwgJHNlc3Npb25TdG9yYWdlLCBTdG9yZURhdGEpIHtcbiAgY29uc29sZS5sb2coJ215QmVlcnNDdHJsJyk7XG4gIHZhciB2bSA9IHRoaXM7XG4gIHZtLmJlZXJzID0ge307XG4gIFVzZXIuZ2V0UGVyc29uKCRzZXNzaW9uU3RvcmFnZS5jdXJyZW50VXNlcikudGhlbihmdW5jdGlvbiAocmVzKSB7XG4gICAgdm0uYmVlcnMgPSByZXMuZGF0YS5yYXRpbmdzO1xuICAgIGNvbnNvbGUubG9nKHZtLmJlZXJzKTtcbiAgICB2bS5iZWVycyA9IHZtLmJlZXJzLmZpbHRlcihmdW5jdGlvbiAoYmVlcikge1xuICAgICAgcmV0dXJuIGJlZXIuc2NvcmUgIT09IHVuZGVmaW5lZDtcbiAgICB9KTtcbiAgfSk7XG4gIHZtLmRlbGV0ZVJhdGluZyA9IGZ1bmN0aW9uIChpZCkge1xuICAgIFVzZXIuZGVsZXRlUmF0aW5nKGlkKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgIFVzZXIuZ2V0UGVyc29uKCRzZXNzaW9uU3RvcmFnZS5jdXJyZW50VXNlcikudGhlbihmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgIHZtLmJlZXJzID0gcmVzLmRhdGEucmF0aW5ncztcbiAgICAgICAgY29uc29sZS5sb2codm0uYmVlcnMpO1xuICAgICAgICB2bS5iZWVycyA9IHZtLmJlZXJzLmZpbHRlcihmdW5jdGlvbiAoYmVlcikge1xuICAgICAgICAgIHJldHVybiBiZWVyLnNjb3JlICE9PSB1bmRlZmluZWQ7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG5cbiAgdm0uc29ydEJ5ID0gZnVuY3Rpb24gKG9yZGVyKSB7XG4gICAgaWYgKHZtLnNvcnRPcmRlciA9PT0gb3JkZXIpIHtcbiAgICAgIHZtLnNvcnRPcmRlciA9IFwiLVwiICsgb3JkZXI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZtLnNvcnRPcmRlciA9IG9yZGVyO1xuICAgIH1cbiAgfTtcblxuICB2bS5lZGl0UmF0aW5nID0gZnVuY3Rpb24gKGlkLCBzY29yZSwgY29tbWVudCkge1xuICAgIFN0b3JlRGF0YS5zZXQoeyAnZWRpdGVkJzogdHJ1ZSwgXCJsb2FkXCI6IHsgXCJzY29yZVwiOiBzY29yZSwgXCJjb21tZW50XCI6IGNvbW1lbnQgfSB9KTtcbiAgICAkc3RhdGUuZ28oJ3Jldmlld3NwZWNpZmljJywgeyBcImlkXCI6IGlkIH0pO1xuICB9O1xufTtcbid1c2Ugc3RyaWN0JztcblxuYW5ndWxhci5tb2R1bGUoJ2JlZXJBcHAnKS5jb250cm9sbGVyKCdwcm9maWxlQ3RybCcsIHByb2ZpbGVDdHJsKTtcblxuZnVuY3Rpb24gcHJvZmlsZUN0cmwoVXNlciwgJHN0YXRlLCAkc2Vzc2lvblN0b3JhZ2UpIHtcbiAgY29uc29sZS5sb2coJ3Byb2ZpbGVDdHJsJyk7XG4gIHZhciB2bSA9IHRoaXM7XG4gIHZtLnVzZXIgPSB7fTtcbiAgVXNlci5nZXRQZXJzb24oJHNlc3Npb25TdG9yYWdlLmN1cnJlbnRVc2VyKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcbiAgICB2bS51c2VyID0gcmVzLmRhdGE7XG4gIH0pO1xuICB2bS5lZGl0UHJvZmlsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAkc3RhdGUuZ28oJ2VkaXRQcm9maWxlJyk7XG4gIH07XG59O1xuJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyLm1vZHVsZSgnYmVlckFwcCcpLmNvbnRyb2xsZXIoJ3JlZ0N0cmwnLCByZWdDdHJsKTtcblxuZnVuY3Rpb24gcmVnQ3RybChVc2VyLCAkc3RhdGUsICR0aW1lb3V0KSB7XG4gIGNvbnNvbGUubG9nKCdyZWdDdHJsJyk7XG4gIHZhciB2bSA9IHRoaXM7XG4gIHZtLnJlZ2lzdHJhdGlvbiA9IHt9O1xuICB2bS5zdWNjZXNzID0gZmFsc2U7XG4gIHZtLnBhc3N3b3Jkc05vdE1hdGNoID0gZmFsc2U7XG4gIHZtLnJlZ2lzdGVyID0gZnVuY3Rpb24gKCkge1xuICAgIGlmICh2bS5yZWdpc3RyYXRpb24ucGFzc3dvcmQxICE9PSB2bS5yZWdpc3RyYXRpb24ucGFzc3dvcmQyKSByZXR1cm4gdm0ucGFzc3dvcmRzTm90TWF0Y2ggPSB0cnVlO1xuICAgIHZhciBuZXdVc2VyID0ge1xuICAgICAgZW1haWw6IHZtLnJlZ2lzdHJhdGlvbi5lbWFpbCxcbiAgICAgIHBhc3N3b3JkOiB2bS5yZWdpc3RyYXRpb24ucGFzc3dvcmQxXG4gICAgfTtcbiAgICB2bS5zdWNjZXNzID0gdHJ1ZTtcbiAgICBVc2VyLnNpZ251cChuZXdVc2VyKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICRzdGF0ZS5nbygnbG9naW4nKTtcbiAgICB9KTtcbiAgfTtcbn07XG4ndXNlIHN0cmljdCc7XG5cbmFuZ3VsYXIubW9kdWxlKCdiZWVyQXBwJykuY29udHJvbGxlcigncmV2aWV3Q3RybCcsIHJldmlld0N0cmwpO1xuXG5mdW5jdGlvbiByZXZpZXdDdHJsKFVzZXIsICRzdGF0ZSwgJHNlc3Npb25TdG9yYWdlLCBCZWVyQVBJKSB7XG4gIGNvbnNvbGUubG9nKCdyZXZpZXdDdHJsJyk7XG4gIHZhciB2bSA9IHRoaXM7XG4gIHZtLmJlZXIgPSB7fTtcbiAgdm0ubG9hZGluZyA9IHRydWU7XG4gIHZtLnJhdGluZyA9IHt9O1xuICBCZWVyQVBJLmdldFJhbmRvbSgpLnRoZW4oZnVuY3Rpb24gKHJlcykge1xuICAgIHZtLmJlZXIgPSByZXMuZGF0YTtcbiAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gIH0pO1xuICB2bS5yYXRlID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciByYXRpbmdPYmogPSB7XG4gICAgICBiZWVySWQ6IHZtLmJlZXIuaWQsXG4gICAgICBiZWVyTmFtZTogdm0uYmVlci5uYW1lLFxuICAgICAgc2NvcmU6IHZtLnJhdGluZy5zY29yZSxcbiAgICAgIGNvbW1lbnQ6IHZtLnJhdGluZy5jb21tZW50XG4gICAgfTtcbiAgICBVc2VyLmFkZFJhdGluZyhyYXRpbmdPYmopLnRoZW4oZnVuY3Rpb24gKHJlcykge1xuICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICBCZWVyQVBJLmdldFJhbmRvbSgpLnRoZW4oZnVuY3Rpb24gKHJlcykge1xuICAgICAgICB2bS5iZWVyID0gcmVzLmRhdGE7XG4gICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuXG4gIHZtLm5vdHNhbXBsZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgY29uc29sZS5sb2coJ3doaGFhYXQnKTtcbiAgICB2YXIgcmF0aW5nT2JqID0ge1xuICAgICAgYmVlcklkOiB2bS5iZWVyLmlkLFxuICAgICAgYmVlck5hbWU6IHZtLmJlZXIubmFtZSxcbiAgICAgIHNjb3JlOiB1bmRlZmluZWQsXG4gICAgICBjb21tZW50OiB1bmRlZmluZWRcbiAgICB9O1xuICAgIFVzZXIuYWRkUmF0aW5nKHJhdGluZ09iaikudGhlbihmdW5jdGlvbiAocmVzKSB7XG4gICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgIEJlZXJBUEkuZ2V0UmFuZG9tKCkudGhlbihmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgIHZtLmJlZXIgPSByZXMuZGF0YTtcbiAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG59O1xuJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyLm1vZHVsZSgnYmVlckFwcCcpLmNvbnRyb2xsZXIoJ3Jldmlld3NwZWNpZmljQ3RybCcsIHJldmlld3NwZWNpZmljQ3RybCk7XG5cbmZ1bmN0aW9uIHJldmlld3NwZWNpZmljQ3RybChVc2VyLCAkc3RhdGUsICRzZXNzaW9uU3RvcmFnZSwgQmVlckFQSSwgJHN0YXRlUGFyYW1zLCBTdG9yZURhdGEpIHtcbiAgY29uc29sZS5sb2coJ3Jldmlld3NwZWNpZmljQ3RybCcpO1xuICB2YXIgdm0gPSB0aGlzO1xuICB2bS5iZWVyID0ge307XG4gIHZtLmxvYWRpbmcgPSB0cnVlO1xuICB2bS5yYXRpbmcgPSB7fTtcblxuICBCZWVyQVBJLmdldEJ5SWQoJHN0YXRlUGFyYW1zLmlkKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcbiAgICB2bS5iZWVyID0gcmVzLmRhdGE7XG4gICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgIHZhciBpbmZvID0gU3RvcmVEYXRhLmdldCgpO1xuICAgIGlmIChpbmZvLmVkaXRlZCkge1xuICAgICAgY29uc29sZS5sb2coaW5mby5sb2FkLnNjb3JlKTtcbiAgICAgIHZtLnJhdGluZy5zY29yZSA9IGluZm8ubG9hZC5zY29yZTtcbiAgICAgIHZtLnJhdGluZy5jb21tZW50ID0gaW5mby5sb2FkLmNvbW1lbnQ7XG4gICAgfVxuICB9KTtcblxuICB2bS5yYXRlID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciByYXRpbmdPYmogPSB7XG4gICAgICBiZWVySWQ6IHZtLmJlZXIuaWQsXG4gICAgICBiZWVyTmFtZTogdm0uYmVlci5uYW1lLFxuICAgICAgc2NvcmU6IHZtLnJhdGluZy5zY29yZSxcbiAgICAgIGNvbW1lbnQ6IHZtLnJhdGluZy5jb21tZW50XG4gICAgfTtcbiAgICBVc2VyLmFkZFJhdGluZ1RvU3BlY2lmaWMocmF0aW5nT2JqLmJlZXJJZCwgcmF0aW5nT2JqKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgIHZhciBpbmZvID0gU3RvcmVEYXRhLmdldCgpO1xuXG4gICAgICBpZiAoaW5mby5lZGl0ZWQpIHJldHVybiAkc3RhdGUuZ28oJ215QmVlcnMnKTtcbiAgICAgICRzdGF0ZS5nbygnYWxsQmVlcnMnKTtcbiAgICB9KTtcbiAgfTtcblxuICB2bS5ub3RzYW1wbGVkID0gZnVuY3Rpb24gKCkge1xuICAgICRzdGF0ZS5nbygnYWxsQmVlcnMnKTtcbiAgfTtcbn07XG4ndXNlIHN0cmljdCc7XG5cbnZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnYmVlckFwcCcpO1xuXG5hcHAuc2VydmljZSgnVXNlcicsIGZ1bmN0aW9uICgkaHR0cCwgJHNlc3Npb25TdG9yYWdlKSB7XG5cbiAgdGhpcy5zaWdudXAgPSBmdW5jdGlvbiAobmV3VXNlck9iaikge1xuICAgIHJldHVybiAkaHR0cC5wb3N0KCcuL2FwaS91c2Vycy9yZWdpc3RlcicsIG5ld1VzZXJPYmopO1xuICB9O1xuXG4gIHRoaXMubG9naW4gPSBmdW5jdGlvbiAobG9naW5EZXRhaWxzT2JqKSB7XG4gICAgcmV0dXJuICRodHRwLnBvc3QoJy4vYXBpL3VzZXJzL2xvZ2luJywgbG9naW5EZXRhaWxzT2JqKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgIGNvbnNvbGUubG9nKHJlcyk7XG4gICAgICAkc2Vzc2lvblN0b3JhZ2UuY3VycmVudFVzZXIgPSByZXMuZGF0YTtcbiAgICB9KTtcbiAgfTtcbiAgdGhpcy5sb2dvdXQgPSBmdW5jdGlvbiAobG9naW5EZXRhaWxzT2JqKSB7XG4gICAgcmV0dXJuICRodHRwLmRlbGV0ZSgnLi9hcGkvdXNlcnMvbG9nb3V0JywgbG9naW5EZXRhaWxzT2JqKTtcbiAgfTtcblxuICB0aGlzLmxvYWRwcm9maWxlID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiAkaHR0cC5nZXQoJy4vYXBpL3VzZXJzL3Byb2ZpbGUnKTtcbiAgfTtcblxuICB0aGlzLmVkaXRwcm9maWxlID0gZnVuY3Rpb24gKGVkaXRlZFVzZXJPYmopIHtcbiAgICByZXR1cm4gJGh0dHAucHV0KCcuL2FwaS91c2Vycy9wcm9maWxlJywgZWRpdGVkVXNlck9iaik7XG4gIH07XG5cbiAgdGhpcy5nZXRQZW9wbGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuICRodHRwLmdldCgnLi9hcGkvdXNlcnMvcGVvcGxlJyk7XG4gIH07XG5cbiAgdGhpcy5nZXRQZXJzb24gPSBmdW5jdGlvbiAoaWQpIHtcbiAgICByZXR1cm4gJGh0dHAuZ2V0KCcuL2FwaS91c2Vycy9wZW9wbGUvJyArIGlkKTtcbiAgfTtcblxuICB0aGlzLmFkZFJhdGluZyA9IGZ1bmN0aW9uIChyYXRpbmdPYmopIHtcbiAgICByZXR1cm4gJGh0dHAucG9zdCgnLi9hcGkvdXNlcnMvYWRkUmF0aW5nLycsIHJhdGluZ09iaik7XG4gIH07XG5cbiAgdGhpcy5kZWxldGVSYXRpbmcgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICByZXR1cm4gJGh0dHAuZGVsZXRlKCcuL2FwaS91c2Vycy9kZWxldGVSYXRpbmcvJyArIGlkKTtcbiAgfTtcblxuICB0aGlzLmFkZFJhdGluZ1RvU3BlY2lmaWMgPSBmdW5jdGlvbiAoYmVlcklkLCBvYmopIHtcbiAgICByZXR1cm4gJGh0dHAucG9zdCgnLi9hcGkvdXNlcnMvYWRkUmF0aW5nVG9TcGVjaWZpYy8nICsgYmVlcklkLCBvYmopO1xuICB9O1xuXG4gIHRoaXMuZ2V0Tm90U2FtcGxlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gJGh0dHAuZ2V0KCcuL2FwaS91c2Vycy9nZXROb3RTYW1wbGVkJyk7XG4gIH07XG59KTtcblxuYXBwLnNlcnZpY2UoJ0JlZXJBUEknLCBmdW5jdGlvbiAoJGh0dHApIHtcblxuICB0aGlzLmdldFJhbmRvbSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gJGh0dHAuZ2V0KFwiLi9hcGkvYmVlcnMvZ2V0UmFuZG9tXCIpO1xuICB9O1xuXG4gIHRoaXMuZ2V0QnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgIHJldHVybiAkaHR0cC5nZXQoXCIuL2FwaS9iZWVycy9nZXRCeUlkL1wiICsgaWQpO1xuICB9O1xufSk7XG5cbmFwcC5zZXJ2aWNlKCdTdG9yZURhdGEnLCBmdW5jdGlvbiAoKSB7XG4gIHZhciBzdG9yZURhdGEgPSB7fTtcbiAgdGhpcy5nZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHN0b3JlRGF0YTtcbiAgfTtcbiAgdGhpcy5zZXQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgIHN0b3JlRGF0YSA9IGRhdGE7XG4gIH07XG59KTsiLCIndXNlIHN0cmljdCc7XG5cbnZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnYmVlckFwcCcpO1xuXG5hcHAuc2VydmljZSgnVXNlcicsIGZ1bmN0aW9uKCRodHRwLCAkc2Vzc2lvblN0b3JhZ2UpIHtcblxuICB0aGlzLnNpZ251cCA9IChuZXdVc2VyT2JqKSA9PiB7XG4gICAgcmV0dXJuICRodHRwLnBvc3QoJy4vYXBpL3VzZXJzL3JlZ2lzdGVyJywgbmV3VXNlck9iaik7XG4gIH1cblxuICB0aGlzLmxvZ2luID0gKGxvZ2luRGV0YWlsc09iaikgPT4ge1xuICAgIHJldHVybiAkaHR0cC5wb3N0KCcuL2FwaS91c2Vycy9sb2dpbicsIGxvZ2luRGV0YWlsc09iailcbiAgICAgICAgICAgICAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXMpO1xuICAgICAgICAgICAgICAgICAgJHNlc3Npb25TdG9yYWdlLmN1cnJlbnRVc2VyID0gcmVzLmRhdGE7XG4gICAgICAgICAgICAgICAgfSk7XG4gIH1cbiAgdGhpcy5sb2dvdXQgPSAobG9naW5EZXRhaWxzT2JqKSA9PiB7XG4gICAgcmV0dXJuICRodHRwLmRlbGV0ZSgnLi9hcGkvdXNlcnMvbG9nb3V0JywgbG9naW5EZXRhaWxzT2JqKTtcbiAgfVxuXG4gIHRoaXMubG9hZHByb2ZpbGUgPSAoKSA9PiB7XG4gICAgcmV0dXJuICRodHRwLmdldCgnLi9hcGkvdXNlcnMvcHJvZmlsZScpO1xuICB9XG5cbiAgdGhpcy5lZGl0cHJvZmlsZSA9IChlZGl0ZWRVc2VyT2JqKSA9PiB7XG4gICAgcmV0dXJuICRodHRwLnB1dCgnLi9hcGkvdXNlcnMvcHJvZmlsZScsIGVkaXRlZFVzZXJPYmopO1xuICB9XG5cbiAgdGhpcy5nZXRQZW9wbGUgPSAoKSA9PiB7XG4gICAgcmV0dXJuICRodHRwLmdldCgnLi9hcGkvdXNlcnMvcGVvcGxlJyk7XG4gIH1cblxuICB0aGlzLmdldFBlcnNvbiA9IChpZCkgPT4ge1xuICAgIHJldHVybiAkaHR0cC5nZXQoJy4vYXBpL3VzZXJzL3Blb3BsZS8nICsgaWQpO1xuICB9XG5cbiAgdGhpcy5hZGRSYXRpbmcgPSAocmF0aW5nT2JqKSA9PiB7XG4gICAgcmV0dXJuICRodHRwLnBvc3QoJy4vYXBpL3VzZXJzL2FkZFJhdGluZy8nLCByYXRpbmdPYmopO1xuICB9XG5cbiAgdGhpcy5kZWxldGVSYXRpbmcgPSAoaWQpID0+IHtcbiAgICByZXR1cm4gJGh0dHAuZGVsZXRlKCcuL2FwaS91c2Vycy9kZWxldGVSYXRpbmcvJyArIGlkKTtcbiAgfVxuXG4gIHRoaXMuYWRkUmF0aW5nVG9TcGVjaWZpYyA9IChiZWVySWQsIG9iaikgPT4ge1xuICAgIHJldHVybiAkaHR0cC5wb3N0KCcuL2FwaS91c2Vycy9hZGRSYXRpbmdUb1NwZWNpZmljLycgKyBiZWVySWQsIG9iaik7XG4gIH1cblxuICB0aGlzLmdldE5vdFNhbXBsZWQgPSAoKSA9PiB7XG4gICAgcmV0dXJuICRodHRwLmdldCgnLi9hcGkvdXNlcnMvZ2V0Tm90U2FtcGxlZCcpO1xuICB9XG5cbn0pXG5cbmFwcC5zZXJ2aWNlKCdCZWVyQVBJJywgZnVuY3Rpb24oJGh0dHApIHtcblxuICB0aGlzLmdldFJhbmRvbSA9ICgpID0+IHtcbiAgICByZXR1cm4gJGh0dHAuZ2V0KFwiLi9hcGkvYmVlcnMvZ2V0UmFuZG9tXCIpO1xuICB9XG5cbiAgdGhpcy5nZXRCeUlkID0gKGlkKSA9PiB7XG4gICAgcmV0dXJuICRodHRwLmdldChcIi4vYXBpL2JlZXJzL2dldEJ5SWQvXCIgKyBpZCk7XG4gIH1cblxufSlcblxuYXBwLnNlcnZpY2UoJ1N0b3JlRGF0YScsIGZ1bmN0aW9uKCkge1xuICB2YXIgc3RvcmVEYXRhID0ge307XG4gIHRoaXMuZ2V0ID0gKCkgPT4geyByZXR1cm4gc3RvcmVEYXRhIH1cbiAgdGhpcy5zZXQgPSAoZGF0YSkgPT4geyBzdG9yZURhdGEgPSBkYXRhIH1cbn0pIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
